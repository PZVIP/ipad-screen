<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Bitcoin Dashboard</title>
    <style>
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden; /* 禁止滚动 */
            -webkit-user-select: none; /* 禁止选中文本 */
            
            /* 关键：利用 padding 避开顶部的刘海/状态栏区域 */
            padding-top: env(safe-area-inset-top);
            box-sizing: border-box;
        }

        /* 交易对标题 */
        #pair {
            font-size: 3vw; /* 响应式字体 */
            color: #666;
            margin-bottom: 2vh;
            font-weight: 400;
            letter-spacing: 2px;
        }

        /* 价格大字 */
        #price {
            font-size: 18vw; /* 超大字体，根据屏幕宽度自动缩放 */
            font-weight: 700;
            line-height: 1;
            font-variant-numeric: tabular-nums; /* 等宽数字，防止跳动 */
            transition: color 0.2s ease;
        }

        /* 涨跌幅 */
        #percent {
            font-size: 5vw;
            margin-top: 3vh;
            font-weight: 500;
            padding: 5px 15px;
            border-radius: 10px;
        }

        /* 颜色定义 */
        .up { color: #0ecb81; } /* 涨-绿色 */
        .down { color: #f6465d; } /* 跌-红色 */
        .neutral { color: #ffffff; }

        /* 底部状态栏 */
        #footer {
            position: absolute;
            bottom: 4vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        #clock {
            font-size: 1.5rem;
            color: #444;
            font-family: "SF Mono", monospace;
        }

        #status {
            font-size: 0.8rem;
            color: #333;
        }
        
        /* 加载/重连时的呼吸动画 */
        .blink {
            animation: blinker 1.5s linear infinite;
        }
        @keyframes blinker {
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body>

    <div id="pair">BTC / USDT</div>
    <div id="price" class="blink">---.--</div>
    <div id="percent">--%</div>

    <div id="footer">
        <div id="clock">Loading...</div>
        <div id="status">Data via Binance Vision</div>
    </div>

    <script>
        // --- 核心配置 ---
        const SYMBOL = 'BTCUSDT';
        // 使用更稳定的 REST API
        const API_URL = `https://data-api.binance.vision/api/v3/ticker/24hr?symbol=${SYMBOL}`;
        const REFRESH_RATE = 2000; // 2秒刷新一次
        // ---------------

        const priceEl = document.getElementById('price');
        const percentEl = document.getElementById('percent');
        const clockEl = document.getElementById('clock');
        const statusEl = document.getElementById('status');
        
        let prevPrice = 0;
        let failCount = 0;

        // 获取数据的异步函数
        async function fetchData() {
            try {
                const res = await fetch(API_URL);
                if (!res.ok) throw new Error("API Error");
                
                const data = await res.json();
                
                // 处理数据
                const currentPrice = parseFloat(data.lastPrice).toFixed(2); // 保留2位小数
                const priceChange = parseFloat(data.priceChangePercent).toFixed(2);
                
                // 1. 更新价格 & 颜色逻辑
                priceEl.innerText = currentPrice;
                priceEl.classList.remove('blink'); // 移除加载动画

                // 颜色判断：比上次高变绿，比上次低变红
                if (prevPrice > 0) {
                    if (currentPrice > prevPrice) {
                        priceEl.className = 'up';
                    } else if (currentPrice < prevPrice) {
                        priceEl.className = 'down';
                    }
                } else {
                    // 第一次加载，根据当天涨跌幅定色
                    priceEl.className = priceChange >= 0 ? 'up' : 'down';
                }
                
                prevPrice = currentPrice;

                // 2. 更新涨跌幅
                percentEl.innerText = (priceChange > 0 ? '+' : '') + priceChange + '%';
                percentEl.className = priceChange >= 0 ? 'up' : 'down';
                // 给涨跌幅加个微弱的背景色以便区分
                percentEl.style.backgroundColor = priceChange >= 0 ? 'rgba(14, 203, 129, 0.1)' : 'rgba(246, 70, 93, 0.1)';

                // 重置错误计数
                failCount = 0;
                statusEl.innerText = "• Live Data";
                statusEl.style.color = "#333";

            } catch (err) {
                console.error(err);
                failCount++;
                // 如果连续失败超过3次，显示警告
                if(failCount > 3) {
                    statusEl.innerText = "Reconnecting...";
                    statusEl.style.color = "#f6465d";
                    priceEl.classList.add('blink'); // 价格开始闪烁表示旧数据
                }
            }
        }

        // 时钟更新
        function updateTime() {
            const now = new Date();
            // 显示 HH:MM:SS
            clockEl.innerText = now.toLocaleTimeString('en-US', { hour12: false });
        }

        // --- 启动 ---
        fetchData(); // 立即执行一次
        setInterval(fetchData, REFRESH_RATE); // 开启价格轮询
        setInterval(updateTime, 1000); // 开启时钟轮询

        // 页面可见性处理：当页面重新回到前台时，立即刷新一次
        document.addEventListener("visibilitychange", () => {
            if (!document.hidden) {
                fetchData();
            }
        });
    </script>
</body>
</html>
