<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>911 å®šæŠ•çœ‹æ¿ (æœ€ç»ˆå®šç¨¿)</title>
    <style>
        /* 0. å…¨å±€å¤ä½ */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-font-smoothing: antialiased; }

        body {
            background-color: #333; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: "Helvetica Neue", Helvetica, Arial, "Microsoft YaHei", sans-serif;
            overflow: auto; 
            padding: 20px;
        }

        /* 1. ä¸»å®¹å™¨ */
        .container {
            width: 500px; 
            background-color: #009688; /* æ ¸å¿ƒ Teal è‰² */
            color: #ffffff;
            border-radius: 0; 
            margin: auto;
            
            /* âš ï¸ æ–°å¢ï¼šå››å‘¨ 7px çº¯ç™½è¾¹æ¡† */
            border: 10px solid #ffffff;
        }

        /* æœ€ç»ˆç”Ÿæˆçš„å›¾ç‰‡æ ·å¼ */
        #final-image {
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            max-width: 100%;
            height: auto;
            display: block;
        }

        /* 2. å¤´éƒ¨ç¬¬ä¸€å±‚ï¼šæ—¥æœŸåŒº (90px) */
        .header-date-section {
            /* âš ï¸ é«˜åº¦æ§åˆ¶ */
            height: 90px;
            
            /* âš ï¸ çº¯ç™½åˆ†å‰²çº¿ */
            border-bottom: 1px solid #ffffff; 
            
            /* å†…å®¹å‚ç›´å±…ä¸­ */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .date-line {
            font-size: 34px; 
            font-weight: bold;
            letter-spacing: 0.5px;
            color: #ffffff; 
            line-height: 1; /* é˜²æ­¢è¡Œé«˜æ’‘ç ´ */
        }

        /* 3. å¤´éƒ¨ç¬¬äºŒå±‚ï¼šè¯´æ˜åŒº (80px) */
        .header-desc-section {
            /* âš ï¸ é«˜åº¦æ§åˆ¶ */
            height: 80px;
            
            /* âš ï¸ çº¯ç™½åˆ†å‰²çº¿ */
            border-bottom: 1px solid #ffffff; 
            
            /* å†…å®¹å‚ç›´å±…ä¸­ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .title {
            font-size: 24px;
            font-weight: normal;
            margin-bottom: 6px;
            line-height: 1;
        }

        .subtitle {
            font-size: 14px;
            opacity: 0.9;
            font-weight: normal;
            line-height: 1;
        }

        /* æ•°å­—é«˜äº®é»„ */
        .num-highlight { 
            color: #FFF358;      /* é¢œè‰² */
            font-size: 34px;     /* å¤§å°ï¼šè°ƒå¤§è¿™ä¸ªæ•°å­—è®© 2025, 12, 24 ç­‰æ•°å­—æ›´é†’ç›® */
            font-weight: 500;    /* ç²—ç»†ï¼šä½¿ç”¨ 900 æˆ– bold è¾¾åˆ°æœ€ç²—æ•ˆæœ */
        }

        /* 4. ç½‘æ ¼ç³»ç»Ÿ */
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
        }

        .cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            
            /* âš ï¸ é«˜åº¦æ§åˆ¶ */
            height: 95px; 
            
            /* âš ï¸ çº¯ç™½åˆ†å‰²çº¿ */
            border-right: 1px solid #ffffff;
            border-bottom: 1px solid #ffffff;
        }

        .cell:nth-child(2n) { border-right: none; }

        .label {
            font-size: 18px; 
            margin-bottom: 10px; /* ç¨å¾®è°ƒå°é—´è·ä»¥é€‚åº”é«˜åº¦ */
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            color: #fff;
            line-height: 1;
        }

        .value {
            font-size: 30px; 
            font-weight: 400; 
            font-family: Arial, sans-serif; 
            letter-spacing: 0.5px;
            line-height: 1;
        }

        /* 5. åº•éƒ¨ Footer (24px) */
        .footer {
            /* âš ï¸ é«˜åº¦æ§åˆ¶ */
            height: 24px;
            
            padding: 0 10px; /* å·¦å³è¾¹è· */
            display: flex;
            justify-content: space-between;
            align-items: center; /* å‚ç›´å±…ä¸­ */
            
            font-size: 10px; /* å­—ä½“è°ƒå°é€‚é…é«˜åº¦ */
            opacity: 0.95;
            background-color: #009688; 
        }

        /* åŠ è½½å±‚ */
        #loader {
            position: fixed; inset: 0; background: #fff; z-index: 99;
            display: flex; justify-content: center; align-items: center;
            color: #009688; font-size: 14px; font-weight: bold;
            flex-direction: column; gap: 10px;
        }
    </style>
</head>
<body>

    <div id="loader">
        <div>æ­£åœ¨åŒæ­¥æ•°æ®...</div>
        <div style="font-size:12px; opacity: 0.7;">(å³å°†ç”Ÿæˆå›¾ç‰‡)</div>
    </div>

    <div id="image-container" style="display: none;"></div>

    <div class="container" id="html-content" style="position: absolute; left: -9999px;">
        
        <div class="header-date-section">
            <div class="date-line" id="date-html"></div>
        </div>

        <div class="header-desc-section">
            <div class="title">æŠ•èµ„æ ‡çš„</div>
            <div class="subtitle">"æ¯”Xå¸"å æ¯”å¤§äº90%ä»¥ä¸Šçš„åŠ å¯†è´§å¸æŠ•èµ„ç»„åˆ</div>
        </div>

        <div class="grid">
            <div class="cell">
                <div class="label">ğŸ’° æ•´ä½“è´¦æˆ·</div>
                <div class="value" id="total-assets">---</div>
            </div>
            <div class="cell">
                <div class="label">ğŸï¸911å®Œæˆç‡</div>
                <div class="value" id="completion">---</div>
            </div>
            <div class="cell">
                <div class="label">ğŸ˜­ä»Šæ—¥æ”¶ç›Š</div>
                <div class="value" id="daily-profit">---</div>
            </div>
            <div class="cell">
                <div class="label">ğŸš€ç´¯è®¡æ”¶ç›Š</div>
                <div class="value" id="total-profit">---</div>
            </div>
            <div class="cell">
                <div class="label">ğŸŒ•ä»Šæ—¥ä¹°å…¥</div>
                <div class="value" id="daily-buy">---</div>
            </div>
            <div class="cell">
                <div class="label">ğŸŒ—æ—¥å‡ä¹°å…¥</div>
                <div class="value" id="avg-daily-buy">---</div>
            </div>
            <div class="cell">
                <div class="label">ğŸ“ˆç´¯è®¡æ”¶ç›Šç‡</div>
                <div class="value" id="roi">---</div>
            </div>
            <div class="cell">
                <div class="label">âœï¸ç´¯è®¡æˆæœ¬</div>
                <div class="value" id="total-cost">---</div>
            </div>
            <div class="cell">
                <div class="label">ğŸ’³ç°é‡‘è´¦æˆ·</div>
                <div class="value" id="cash-account">---</div>
            </div>
            <div class="cell">
                <div class="label">ğŸšæŠ•èµ„è´¦æˆ·</div>
                <div class="value" id="invest-account">---</div>
            </div>
        </div>

        <div class="footer">
            <span>å¤‡æ³¨ï¼šä»Šæ—¥æ”¶ç›Šæ˜¯ä¸Šæ¬¡æ›´æ–°åˆ°ä»Šå¤©çš„æ”¶ç›Š</span>
            <span>å…¬ä¼—å·ï¼šè©¹å¤§é¹</span>
        </div>
    </div>

    <script>
        // ===========================================
        // âš ï¸ è¯·åœ¨è¿™é‡Œå¡«å…¥æ‚¨çš„ Web App URL
        // ===========================================
        const API_URL = "https://script.google.com/macros/s/AKfycbyXc3hGKA92PEoY543JQUTrLjumxcPYBuADZzHG8oa1nhcpDvvITIFFWnW4B-d3D8OY/exec"; 

        // è¾…åŠ©å‡½æ•°
        function fmtMoney(n) {
            if(n === "" || n === undefined) return "---";
            return "Â¥" + Math.round(Number(n)).toLocaleString('en-US');
        }
        function fmtPercent(n, decimals=0) {
            if(n === "" || n === undefined) return "---";
            return (Number(n) * 100).toFixed(decimals) + "%";
        }
        function colorNumbers(str) {
            return str.replace(/(\d+)/g, '<span class="num-highlight">$1</span>');
        }
        function formatDateToCN(dateStr) {
            let d = new Date(dateStr.replace(/-/g, "/"));
            if(isNaN(d.getTime())) return dateStr;
            return `${d.getFullYear()}å¹´${d.getMonth()+1}æœˆ${d.getDate()}æ—¥`;
        }

        // ä¸»æµç¨‹
        fetch(API_URL)
            .then(res => res.json())
            .then(data => {
                if(data.status === 'error') throw new Error(data.message);

                // å¡«å……æ•°æ®
                let dateCN = formatDateToCN(data.date); 
                let fullStr = `${dateCN}ï¼Œç¬¬${data.days}å¤©`;
                document.getElementById('date-html').innerHTML = colorNumbers(fullStr);

                document.getElementById('total-assets').innerText = fmtMoney(data.total_assets);
                document.getElementById('completion').innerText = fmtPercent(data.completion, 0);
                document.getElementById('daily-profit').innerText = fmtMoney(data.daily_profit);
                document.getElementById('total-profit').innerText = fmtMoney(data.total_profit);
                document.getElementById('daily-buy').innerText = fmtMoney(data.daily_buy);
                document.getElementById('avg-daily-buy').innerText = fmtMoney(data.avg_daily_buy);
                document.getElementById('roi').innerText = fmtPercent(data.roi, 2);
                document.getElementById('total-cost').innerText = fmtMoney(data.total_cost);
                document.getElementById('cash-account').innerText = fmtMoney(data.cash_account);
                let investVal = Number(data.invest_account).toFixed(0);
                document.getElementById('invest-account').innerText = "Â¥" + Number(investVal).toLocaleString('en-US');

                document.getElementById('loader').innerHTML = "<div>æ•°æ®åŒæ­¥å®Œæˆ</div><div>æ­£åœ¨ç”Ÿæˆé«˜æ¸…å›¾ç‰‡...</div>";

                // æˆªå›¾
                const elementToCapture = document.getElementById('html-content');
                html2canvas(elementToCapture, {
                    scale: 2, 
                    backgroundColor: "#009688", 
                    logging: false, 
                    useCORS: true 
                }).then(canvas => {
                    const imgData = canvas.toDataURL("image/png");
                    const newImg = document.createElement('img');
                    newImg.src = imgData;
                    newImg.id = "final-image";
                    newImg.alt = "å®šæŠ•çœ‹æ¿å›¾ç‰‡";
                    
                    const imgContainer = document.getElementById('image-container');
                    imgContainer.appendChild(newImg);
                    imgContainer.style.display = "block";
                    document.getElementById('loader').style.display = 'none';
                });

            })
            .catch(err => {
                console.error(err);
                document.getElementById('loader').innerText = "åŠ è½½å¤±è´¥";
                document.getElementById('loader').style.color = "red";
            });
    </script>
</body>
</html>